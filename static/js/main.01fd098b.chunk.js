(this["webpackJsonpx-fan"]=this["webpackJsonpx-fan"]||[]).push([[0],{38:function(e,t,n){e.exports=n.p+"static/media/github.5a5753ed.svg"},40:function(e,t,n){e.exports=n(65)},64:function(e,t,n){},65:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"user",(function(){return S})),n.d(a,"homeTimeline",(function(){return _})),n.d(a,"settings",(function(){return I}));var r=n(0),o=n.n(r),i=n(25),s=n.n(i),c=n(33),u=n(17),l=n(39),m=n(10),f=n(9),p=n.n(f),g=n(11),d=n(12),h=n(13),b=n(26),v=function(){var e=[];try{e=JSON.parse(localStorage.getItem("accounts"))}catch(t){}return e},w={consumerKey:"a59ed1e1d9c84ece4d90a6bef1ef30b2",consumerSecret:"aba384864b00fe9f3ed8ece4d21556cd",apiDomain:"api.fanfou.com",oauthDomain:"fanfou.com",hooks:{baseString:function(e){return e.replace("https","http")}},protocol:"https:"},y=function(){var e=Object(g.a)(p.a.mark((function e(t,n){var a,r,o,i,s,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new b.a(Object(d.a)({},w,{username:t,password:n})),e.next=3,a.xauth();case 3:if(r=e.sent,o=r.oauthToken,i=r.oauthTokenSecret,!o||!i){e.next=11;break}return s=new b.a(Object(d.a)({},w,{oauthToken:o,oauthTokenSecret:i})),e.next=9,s.get("/account/verify_credentials",{});case 9:return c=e.sent,e.abrupt("return",{token:r,profile:c});case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),O=function(){var e=v();if(0!==e.length){var t=Object(h.a)(e,1)[0].token,n=t.oauthToken,a=t.oauthTokenSecret;return new b.a(Object(d.a)({},w,{oauthToken:n,oauthTokenSecret:a}))}},k=function(e){return O().get("/statuses/home_timeline",Object(d.a)({},e,{format:"html",count:30}))},j=function(e){var t=O();return e.photo?t.upload("/photos/upload",Object(d.a)({},e)):t.post("/statuses/update",Object(d.a)({},e))},x=[];try{x=JSON.parse(localStorage.getItem("accounts"))||[]}catch(Y){}var S={state:{accounts:x},reducers:{addAccount:function(e,t){var n=e.accounts.slice();return(n=n.filter((function(e){return e.profile.unique_id!==t.profile.unique_id}))).unshift(t),localStorage.setItem("accounts",JSON.stringify(n)),Object(d.a)({},e,{accounts:n})},logout:function(){return{accounts:[]}}},effects:{login:function(e){var t=this;return Object(g.a)(p.a.mark((function n(){var a,r,o;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.username,r=e.password,n.next=3,y(a,r);case 3:return(o=n.sent)&&t.addAccount(o),n.abrupt("return",o);case 6:case"end":return n.stop()}}),n)})))()}}},E=function(e){return!!["",".","\u4e0a\u4f20\u4e86\u65b0\u7167\u7247"].includes(e)||!!Number.isInteger(Number(e))},_={state:{loading:null,sending:null,typing:!1,timeline:[]},reducers:{setLoading:function(e,t){return Object(d.a)({},e,{loading:t})},setSending:function(e,t){return Object(d.a)({},e,{sending:t})},setTimeline:function(e,t){return Object(d.a)({},e,{timeline:t})},appendStatus:function(e,t){var n=e.timeline.concat(t);return Object(d.a)({},e,{timeline:n})},clearTimeline:function(){return{loading:null,sending:null,typing:!1,timeline:[]}}},effects:{fetch:function(e,t){var n=this;return Object(g.a)(p.a.mark((function a(){var r,o,i,s,c,u,l,m,f,g,d,b;return p.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return 0===(r=t.homeTimeline.timeline).length&&n.setLoading({header:"Loading",avatar:"/x-fan.png"}),a.next=4,k(e);case 4:if(o=a.sent,i=t.homeTimeline.timeline,s=i.slice().reverse(),c=Object(h.a)(s,1),u=c[0],l=(u=void 0===u?{rawId:0}:u).rawId,o=o.filter((function(e){return e.isOrigin()&&e.rawid>l})),m=i.slice(),o.reverse().forEach((function(e){e.photo&&m.push({id:e.id+"-photo",rawId:e.rawid,type:e.is_self?"sent":"received",avatar:e.user.profile_image_url_large,name:e.user.name,image:e.photo.originurl}),E(e.text)||m.push({id:e.id,rawId:e.rawid,name:e.user.name,type:e.is_self?"sent":"received",text:e.plain_text,avatar:e.user.profile_image_url_large})})),m=m.slice(-200),0!==r.length){a.next=18;break}n.setLoading(null),n.setTimeline(m),a.next=28;break;case 18:if(f=m[m.length-1].rawId,g=r[r.length-1].rawId,!(f>g)){a.next=27;break}d=m[m.length-1].text.length,b=1e3+parseInt((d+1)/140*4e3,10),n.setLoading({header:m[m.length-1].name,avatar:m[m.length-1].avatar}),setTimeout((function(){n.setLoading(null),n.setTimeline(m)}),b),a.next=28;break;case 27:case 28:return a.abrupt("return",m);case 29:case"end":return a.stop()}}),a)})))()},post:function(e){var t=this;return Object(g.a)(p.a.mark((function n(){var a,r;return p.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.setSending(e),n.next=3,j(Object(d.a)({},e));case 3:if(!(a=n.sent).error){n.next=7;break}return t.setSending(null),n.abrupt("return",a);case 7:return r=[],a.photo&&r.push({id:a.id+"-photo",rawId:a.rawid,type:a.is_self?"sent":"received",avatar:a.user.profile_image_url_large,name:a.user.name,image:a.photo.originurl}),E(a.text)||r.push({id:a.id,rawId:a.rawid,name:a.user.name,type:a.is_self?"sent":"received",text:a.plain_text,avatar:a.user.profile_image_url_large}),t.setSending(null),t.appendStatus(r),n.abrupt("return",r);case 13:case"end":return n.stop()}}),n)})))()}}},T={};try{T=JSON.parse(localStorage.getItem("settings")||{})}catch(Y){}var I={state:Object(d.a)({},{},{},T),reducers:{updateSettings:function(e){return localStorage.setItem("settings",JSON.stringify(e)),e}},effects:{}},C=n(2),M=n(3),L=n(1),A=n(4),N=n(5),$=function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(L.a)(this,(e=Object(A.a)(t)).call.apply(e,[this].concat(r)))).state={username:"",password:""},n.login=Object(g.a)(p.a.mark((function e(){var t,a,r,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.state,a=t.username,r=t.password,o=n.props.login,e.next=4,o({username:a,password:r});case 4:if(i=e.sent,a&&r){e.next=8;break}return n.$f7.dialog.alert("Username and password do not match"),e.abrupt("return");case 8:null===i?n.$f7.dialog.alert("Username and password do not match"):n.$f7router.navigate("/messages/",{clearPreviousHistory:!0});case 9:case"end":return e.stop()}}),e)}))),n}return Object(N.a)(t,e),Object(M.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(m.r,{noToolbar:!0,noNavbar:!0,noSwipeback:!0,loginScreen:!0},o.a.createElement(m.i,null,"X-FAN"),o.a.createElement(m.f,{form:!0},o.a.createElement(m.h,{label:"Username",type:"text",placeholder:"Your username",onInput:function(t){e.setState({username:t.target.value})}}),o.a.createElement(m.h,{label:"Password",type:"password",placeholder:"Your password",onInput:function(t){e.setState({password:t.target.value})}})),o.a.createElement(m.f,null,o.a.createElement(m.g,{onClick:this.login},"Sign In"),o.a.createElement(m.c,null,"Code with \u2764\ufe0f\ufe0f by LitoMore")))}}]),t}(o.a.Component);$.defaultProps={login:function(){}};var q=Object(u.b)((function(e){var t=Object(h.a)(e.user.accounts,1)[0];return{current:void 0===t?{}:t}}),(function(e){return{login:function(t){return e.user.login(t)}}}))($),J=function(e){function t(){var e,n;Object(C.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(L.a)(this,(e=Object(A.a)(t)).call.apply(e,[this].concat(r)))).state={photo:null,photos:[],messageText:""},n.sendMessage=Object(g.a)(p.a.mark((function e(){var t,a,r,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.state.photo,a=n.messagebar.getValue()){e.next=5;break}return n.$f7.dialog.alert("\u4fe1\u606f\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u8f93\u5165\u4fe1\u606f\u5185\u5bb9\uff01"),e.abrupt("return");case 5:return r={status:a},t&&(r.photo=t.file),e.prev=7,e.next=10,n.props.post(r);case 10:(o=e.sent).error?n.$f7.dialog.alert(o.error):(document.querySelector("#file").value="",n.messagebar.clear(),n.setState({photo:null})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),t?n.$f7.dialog.alert("\u56fe\u7247\u6587\u4ef6\u8fc7\u5927"):n.$f7.dialog.alert("\u53d1\u9001\u5931\u8d25");case 17:case"end":return e.stop()}}),e,null,[[7,14]])}))),n}return Object(N.a)(t,e),Object(M.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.fetch(),this.timer=setInterval((function(){e.props.fetch()}),1e4);var t=this;t.$f7ready((function(){t.messagebar=t.messagebarComponent.f7Messagebar,t.messages=t.messagesComponent.f7Messages}))}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"isFirstMessage",value:function(e,t){var n=this.props.messages[t-1];return!e.isTitle&&(!n||n.type!==e.type||n.name!==e.name)}},{key:"isLastMessage",value:function(e,t){var n=this.props.messages[t+1];return!e.isTitle&&(!n||n.type!==e.type||n.name!==e.name)}},{key:"isTailMessage",value:function(e,t){var n=this.props.messages[t+1];return!e.isTitle&&(!n||n.type!==e.type||n.name!==e.name)}},{key:"render",value:function(){var e=this,t=this.props,n=t.loading,a=t.sending,r=t.messages,i=this.state,s=i.photo,c=i.photos,u=i.messageText,l=window.innerWidth>400?{maxWidth:300}:null;return o.a.createElement(m.r,{name:"messages"},o.a.createElement("input",{id:"file",type:"file",accept:"image/gif, image/jpeg, image/png, image/jpg",style:{display:"none"},onChange:function(){var t=document.querySelector("#file"),n=Object(h.a)(t.files,1)[0];if(n){var a=new FileReader;a.addEventListener("load",(function(t){var a=t.target.result;e.setState({photo:{file:n,url:a}})})),a.readAsDataURL(n)}}}),c.length>0?o.a.createElement(m.s,{ref:function(t){e.photoBrowser=t},navbar:!1,toolbar:!1,photos:c,value:u,onPhotoBrowserClose:function(){e.setState({photos:[]})}}):null,o.a.createElement(m.k,{ref:function(t){e.messagebarComponent=t},attachmentsVisible:Boolean(s),sheetVisible:this.state.sheetVisible,onInput:function(t){e.setState({messageText:t.target.value})}},o.a.createElement(m.e,{iconAurora:"f7:camera_fill",iconIos:"f7:camera_fill",iconMd:"material:camera_alt",slot:"inner-start",onClick:function(){a||document.querySelector("#file").click()}}),o.a.createElement(m.e,{iconAurora:"f7:ellipsis_circle_fill",iconIos:"f7:ellipsis_circle_fill",iconMd:"material:more_vert",slot:"inner-start",onClick:function(){a||e.$f7router.navigate("/settings/")}}),o.a.createElement(m.e,{iconAurora:"f7:arrow_up_circle_fill",iconIos:"f7:arrow_up_circle_fill",iconMd:"material:send",slot:"inner-end",onClick:function(){a||e.sendMessage()}}),o.a.createElement(m.m,null,s?o.a.createElement(m.l,{image:s.url,onAttachmentDelete:function(){document.querySelector("#file").value="",e.setState({photo:null})}}):null)),o.a.createElement(m.n,{ref:function(t){e.messagesComponent=t},scrollMessagesOnEdge:!0},r.map((function(t,n){return o.a.createElement(m.j,{key:t.id,type:t.type,style:t.image?l:null,image:t.image,name:t.name,avatar:t.avatar,first:e.isFirstMessage(t,n),last:e.isLastMessage(t,n),tail:e.isTailMessage(t,n),onClickBubble:function(){t.image&&e.setState({photos:[t.image]},(function(){e.photoBrowser.open()}))}},t.text&&o.a.createElement("span",{slot:"text"},t.text))})),n&&o.a.createElement(m.j,{typing:!0,first:!0,last:!0,tail:!0,type:"received",header:n.header,avatar:n.avatar})))}}]),t}(o.a.Component);J.defaultProps={loading:null,sending:null,messages:[],fetch:function(){},post:function(){}};var P=Object(u.b)((function(e){return{sending:e.homeTimeline.sending,loading:e.homeTimeline.loading,messages:e.homeTimeline.timeline,settings:e.settings}}),(function(e){return{fetch:function(t){return e.homeTimeline.fetch(t)},post:function(t){return e.homeTimeline.post(t)}}}))(J),B=n(38),U=n.n(B),D=function(e){function t(){return Object(C.a)(this,t),Object(L.a)(this,Object(A.a)(t).apply(this,arguments))}return Object(N.a)(t,e),Object(M.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(m.r,{main:!0},o.a.createElement(m.q,null,o.a.createElement(m.o,{backLink:"back"}),o.a.createElement(m.p,null,"Settings")),o.a.createElement(m.d,null,"ACCOUNT"),o.a.createElement(m.f,null,o.a.createElement(m.g,{title:"Logout",color:"red",onClick:function(){e.$f7router.back("/login/",{force:!0}),localStorage.removeItem("accounts"),e.props.logout(),e.props.clearTimeline()}})),o.a.createElement(m.b,{style:{textAlign:"center"}},o.a.createElement(m.e,{external:!0,href:"https://github.com/LitoMore/x-fan",target:"_blank"},o.a.createElement("img",{alt:"github-badge",src:U.a}))))}}]),t}(o.a.Component);D.defaultProps={logout:function(){},clearTimeline:function(){}};var F={name:"X-FAN",id:"com.litomore.xfanfou",routes:[{name:"messages",path:"/messages/",component:P},{name:"login",path:"/login/",component:q},{name:"settings",path:"/settings/",component:Object(u.b)((function(e){return{settings:e.settings}}),(function(e){return{logout:function(){return e.user.logout()},clearTimeline:function(){return e.homeTimeline.clearTimeline()}}}))(D)}],theme:"MacIntel"===window.navigator.platform?"ios":"auto"},W=function(e){function t(){return Object(C.a)(this,t),Object(L.a)(this,Object(A.a)(t).apply(this,arguments))}return Object(N.a)(t,e),Object(M.a)(t,[{key:"render",value:function(){var e=this.props.current;return o.a.createElement(m.a,{params:F},o.a.createElement(m.t,{main:!0,url:e?"/messages/":"/login/"}))}}]),t}(o.a.Component);W.defaultProps={current:null};var V=Object(u.b)((function(e){return{current:Object(h.a)(e.user.accounts,1)[0],settings:e.settings}}))(W);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4]\d|[01]?\d\d?)){3}$/));function R(){return(R=Object(g.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("serviceWorker"in navigator)){e.next=5;break}return e.next=3,navigator.serviceWorker.ready;case 3:e.sent.unregister();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n(61),n(62),n(63),n(64);l.a.use(m.u);var X=Object(c.init)({models:a});s.a.render(o.a.createElement(u.a,{store:X},o.a.createElement(V,null)),document.querySelector("#app")),function(){R.apply(this,arguments)}()}},[[40,1,2]]]);
//# sourceMappingURL=main.01fd098b.chunk.js.map