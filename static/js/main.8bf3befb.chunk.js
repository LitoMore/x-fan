(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{39:function(e,t,n){e.exports=n.p+"static/media/github.5a5753ed.svg"},41:function(e,t,n){e.exports=n(68)},67:function(e,t,n){},68:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"user",function(){return S}),n.d(a,"homeTimeline",function(){return T}),n.d(a,"settings",function(){return I});var r=n(0),o=n.n(r),i=n(26),s=n.n(i),c=n(33),u=n(17),l=n(40),f=n(10),p=n(8),m=n.n(p),d=n(11),g=n(13),h=n(12),v=n(27),b=function(){var e=[];try{e=JSON.parse(localStorage.getItem("accounts"))}catch(t){}return e},w={consumerKey:"a59ed1e1d9c84ece4d90a6bef1ef30b2",consumerSecret:"aba384864b00fe9f3ed8ece4d21556cd",apiDomain:"cors.fanfou.com",oauthDomain:"cors.fanfou.com",hooks:{baseString:function(e){return e.replace("%2F%2Fcors.fanfou.com%2Foauth","http%3A%2F%2Ffanfou.com%2Foauth").replace("%2F%2Fcors.fanfou.com","http%3A%2F%2Fapi.fanfou.com")}}},k=function(){var e=Object(d.a)(m.a.mark(function e(t,n){var a,r,o,i,s,c;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new v.a(Object(g.a)({},w,{username:t,password:n})),e.next=3,a.xauth();case 3:if(r=e.sent,o=r.oauthToken,i=r.oauthTokenSecret,!o||!i){e.next=11;break}return s=new v.a(Object(g.a)({},w,{oauthToken:o,oauthTokenSecret:i})),e.next=9,s.get("/account/verify_credentials",{});case 9:return c=e.sent,e.abrupt("return",{token:r,profile:c});case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=b();if(0!==e.length){var t=Object(h.a)(e,1)[0].token,n=t.oauthToken,a=t.oauthTokenSecret;return new v.a(Object(g.a)({},w,{oauthToken:n,oauthTokenSecret:a}))}},O=function(e){return y().get("/statuses/home_timeline",Object(g.a)({},e,{format:"html",count:30}))},x=function(e){var t=y();return e.photo?t.upload("/photos/upload",Object(g.a)({},e)):t.post("/statuses/update",Object(g.a)({},e))},j=[];try{j=JSON.parse(localStorage.getItem("accounts"))||[]}catch(G){}var S={state:{accounts:j},reducers:{addAccount:function(e,t){var n=e.accounts.slice();return(n=n.filter(function(e){return e.profile.unique_id!==t.profile.unique_id})).unshift(t),localStorage.setItem("accounts",JSON.stringify(n)),Object(g.a)({},e,{accounts:n})},logout:function(){return{accounts:[]}}},effects:{login:function(){var e=Object(d.a)(m.a.mark(function e(t){var n,a,r;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.username,a=t.password,e.next=3,k(n,a);case 3:return(r=e.sent)&&this.addAccount(r),e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},E=function(e){return["",".","\u4e0a\u4f20\u4e86\u65b0\u7167\u7247"].indexOf(e)>=0||!!Number.isInteger(Number(e))},T={state:{loading:null,sending:null,typing:!1,timeline:[]},reducers:{setLoading:function(e,t){return Object(g.a)({},e,{loading:t})},setSending:function(e,t){return Object(g.a)({},e,{sending:t})},setTimeline:function(e,t){return Object(g.a)({},e,{timeline:t})},appendStatus:function(e,t){var n=e.timeline.concat(t);return Object(g.a)({},e,{timeline:n})},clearTimeline:function(){return{loading:null,sending:null,typing:!1,timeline:[]}}},effects:{fetch:function(){var e=Object(d.a)(m.a.mark(function e(t,n){var a,r,o,i,s,c,u,l,f,p,d,g,v=this;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return 0===(a=n.homeTimeline.timeline).length&&this.setLoading({header:"Loading",avatar:"/x-fan.png"}),e.next=4,O(t);case 4:if(r=e.sent,o=n.homeTimeline.timeline,i=o.slice().reverse(),s=Object(h.a)(i,1),c=s[0],u=(c=void 0===c?{rawId:0}:c).rawId,r=r.filter(function(e){return e.isOrigin()&&e.rawid>u}),l=o.slice(),r.reverse().forEach(function(e){e.photo&&l.push({id:e.id+"-photo",rawId:e.rawid,type:e.is_self?"sent":"received",avatar:e.user.profile_image_url_large,name:e.user.name,image:e.photo.originurl}),E(e.text)||l.push({id:e.id,rawId:e.rawid,name:e.user.name,type:e.is_self?"sent":"received",text:e.plain_text,avatar:e.user.profile_image_url_large})}),l=l.slice(-200),0!==a.length){e.next=18;break}this.setLoading(null),this.setTimeline(l),e.next=28;break;case 18:if(f=l[l.length-1].rawId,p=a[a.length-1].rawId,!(f>p)){e.next=27;break}d=l[l.length-1].text.length,g=1e3+parseInt((d+1)/140*4e3,10),this.setLoading({header:l[l.length-1].name,avatar:l[l.length-1].avatar}),setTimeout(function(){v.setLoading(null),v.setTimeline(l)},g),e.next=28;break;case 27:case 28:return e.abrupt("return",l);case 29:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),post:function(){var e=Object(d.a)(m.a.mark(function e(t){var n,a;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setSending(t),e.next=3,x(Object(g.a)({},t));case 3:if(!(n=e.sent).error){e.next=7;break}return this.setSending(null),e.abrupt("return",n);case 7:return a=[],n.photo&&a.push({id:n.id+"-photo",rawId:n.rawid,type:n.is_self?"sent":"received",avatar:n.user.profile_image_url_large,name:n.user.name,image:n.photo.originurl}),E(n.text)||a.push({id:n.id,rawId:n.rawid,name:n.user.name,type:n.is_self?"sent":"received",text:n.plain_text,avatar:n.user.profile_image_url_large}),this.setSending(null),this.appendStatus(a),e.abrupt("return",a);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},_={};try{_=JSON.parse(localStorage.getItem("settings")||{})}catch(G){}var I={state:Object(g.a)({},{},_),reducers:{updateSettings:function(e){return localStorage.setItem("settings",JSON.stringify(e)),e}},effects:{}},C=n(2),A=n(3),M=n(1),L=n(4),F=n(5),N=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(M.a)(this,Object(L.a)(t).call(this,e))).login=Object(d.a)(m.a.mark(function e(){var t,a,r,o,i;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.state,a=t.username,r=t.password,o=n.props.login,e.next=4,o({username:a,password:r});case 4:if(i=e.sent,a&&r){e.next=8;break}return n.$f7.dialog.alert("Username and password do not match"),e.abrupt("return");case 8:null===i?n.$f7.dialog.alert("Username and password do not match"):n.$f7router.navigate("/messages/",{clearPreviousHistory:!0});case 9:case"end":return e.stop()}},e)})),n.state={username:"",password:""},n}return Object(F.a)(t,e),Object(A.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(f.r,{noToolbar:!0,noNavbar:!0,noSwipeback:!0,loginScreen:!0},o.a.createElement(f.i,null,"X-FAN"),o.a.createElement(f.f,{form:!0},o.a.createElement(f.h,{label:"Username",type:"text",placeholder:"Your username",onInput:function(t){e.setState({username:t.target.value})}}),o.a.createElement(f.h,{label:"Password",type:"password",placeholder:"Your password",onInput:function(t){e.setState({password:t.target.value})}})),o.a.createElement(f.f,null,o.a.createElement(f.g,{onClick:this.login},"Sign In"),o.a.createElement(f.c,null,"Code with \u2764\ufe0f\ufe0f by LitoMore")))}}]),t}(o.a.Component);N.defaultProps={login:function(){}};var $=Object(u.b)(function(e){var t=Object(h.a)(e.user.accounts,1)[0];return{current:void 0===t?{}:t}},function(e){return{login:function(t){return e.user.login(t)}}})(N),W=function(e){function t(e){var n;return Object(C.a)(this,t),(n=Object(M.a)(this,Object(L.a)(t).call(this,e))).sendMessage=Object(d.a)(m.a.mark(function e(){var t,a,r,o;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.state.photo,a=n.messagebar.getValue()){e.next=5;break}return n.$f7.dialog.alert("\u4fe1\u606f\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u8f93\u5165\u4fe1\u606f\u5185\u5bb9\uff01"),e.abrupt("return");case 5:return r={status:a},t&&(r.photo=t.file),e.prev=7,e.next=10,n.props.post(r);case 10:(o=e.sent).error?n.$f7.dialog.alert(o.error):(document.querySelector("#file").value="",n.messagebar.clear(),n.setState({photo:null})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),t?n.$f7.dialog.alert("\u56fe\u7247\u6587\u4ef6\u8fc7\u5927"):n.$f7.dialog.alert("\u53d1\u9001\u5931\u8d25");case 17:case"end":return e.stop()}},e,null,[[7,14]])})),n.state={photo:null,photos:[],messageText:""},n}return Object(F.a)(t,e),Object(A.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.fetch(),this.timer=setInterval(function(){e.props.fetch()},1e4);var t=this;t.$f7ready(function(){t.messagebar=t.messagebarComponent.f7Messagebar,t.messages=t.messagesComponent.f7Messages})}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"isFirstMessage",value:function(e,t){var n=this.props.messages[t-1];return!e.isTitle&&(!n||n.type!==e.type||n.name!==e.name)}},{key:"isLastMessage",value:function(e,t){var n=this.props.messages[t+1];return!e.isTitle&&(!n||n.type!==e.type||n.name!==e.name)}},{key:"isTailMessage",value:function(e,t){var n=this.props.messages[t+1];return!e.isTitle&&(!n||n.type!==e.type||n.name!==e.name)}},{key:"render",value:function(){var e=this,t=this.props,n=t.loading,a=t.sending,r=t.messages,i=this.state,s=i.photo,c=i.photos,u=i.messageText,l=window.innerWidth>400?{maxWidth:300}:null;return o.a.createElement(f.r,{name:"messages"},o.a.createElement("input",{id:"file",type:"file",accept:"image/gif, image/jpeg, image/png, image/jpg",style:{display:"none"},onChange:function(){var t=document.querySelector("#file"),n=Object(h.a)(t.files,1)[0];if(n){var a=new FileReader;a.addEventListener("load",function(t){var a=t.target.result;e.setState({photo:{file:n,url:a}})}),a.readAsDataURL(n)}}}),c.length>0?o.a.createElement(f.s,{ref:function(t){e.photoBrowser=t},navbar:!1,toolbar:!1,photos:c,value:u,onPhotoBrowserClose:function(){e.setState({photos:[]})}}):null,o.a.createElement(f.k,{ref:function(t){e.messagebarComponent=t},attachmentsVisible:Boolean(s),sheetVisible:this.state.sheetVisible,onInput:function(t){e.setState({messageText:t.target.value})}},o.a.createElement(f.e,{iconAurora:"f7:camera_fill",iconIos:"f7:camera_fill",iconMd:"material:camera_alt",slot:"inner-start",onClick:function(){a||document.querySelector("#file").click()}}),o.a.createElement(f.e,{iconAurora:"f7:more_round_fill",iconIos:"f7:more_round_fill",iconMd:"material:more_vert",slot:"inner-start",onClick:function(){a||e.$f7router.navigate("/settings/")}}),o.a.createElement(f.e,{iconAurora:"f7:arrow_up_round_fill",iconIos:"f7:arrow_up_round_fill",iconMd:"material:send",slot:"inner-end",onClick:function(){a||e.sendMessage()}}),o.a.createElement(f.m,null,s?o.a.createElement(f.l,{image:s.url,onAttachmentDelete:function(){document.querySelector("#file").value="",e.setState({photo:null})}}):null)),o.a.createElement(f.n,{ref:function(t){e.messagesComponent=t},scrollMessagesOnEdge:!0},r.map(function(t,n){return o.a.createElement(f.j,{key:t.id,type:t.type,style:t.image?l:null,image:t.image,name:t.name,avatar:t.avatar,first:e.isFirstMessage(t,n),last:e.isLastMessage(t,n),tail:e.isTailMessage(t,n),onClickBubble:function(){t.image&&e.setState({photos:[t.image]},function(){e.photoBrowser.open()})}},t.text&&o.a.createElement("span",{slot:"text"},t.text))}),n&&o.a.createElement(f.j,{typing:!0,first:!0,last:!0,tail:!0,type:"received",header:n.header,avatar:n.avatar})))}}]),t}(o.a.Component);W.defaultProps={loading:null,sending:null,messages:[],fetch:function(){},post:function(){}};var P=Object(u.b)(function(e){return{sending:e.homeTimeline.sending,loading:e.homeTimeline.loading,messages:e.homeTimeline.timeline,settings:e.settings}},function(e){return{fetch:function(t){return e.homeTimeline.fetch(t)},post:function(t){return e.homeTimeline.post(t)}}})(W),U=n(39),q=n.n(U),J=function(e){function t(){return Object(C.a)(this,t),Object(M.a)(this,Object(L.a)(t).apply(this,arguments))}return Object(F.a)(t,e),Object(A.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(f.r,{main:!0},o.a.createElement(f.q,null,o.a.createElement(f.o,{backLink:"back"}),o.a.createElement(f.p,null,"Settings")),o.a.createElement(f.d,null,"ACCOUNT"),o.a.createElement(f.f,null,o.a.createElement(f.g,{title:"Logout",color:"red",onClick:function(){e.$f7router.back("/login/",{force:!0}),localStorage.removeItem("accounts"),e.props.logout(),e.props.clearTimeline()}})),o.a.createElement(f.b,{style:{textAlign:"center"}},o.a.createElement(f.e,{external:!0,href:"https://github.com/LitoMore/x-fan",target:"_blank"},o.a.createElement("img",{alt:"github-badge",src:q.a}))))}}]),t}(o.a.Component);J.defaultProps={logout:function(){},clearTimeline:function(){}};var B={name:"X-FAN",id:"com.litomore.xfanfou",routes:[{name:"messages",path:"/messages/",component:P},{name:"login",path:"/login/",component:$},{name:"settings",path:"/settings/",component:Object(u.b)(function(e){return{settings:e.settings}},function(e){return{logout:function(){return e.user.logout()},clearTimeline:function(){return e.homeTimeline.clearTimeline()}}})(J)}],theme:"MacIntel"===window.navigator.platform?"ios":"auto"},D=function(e){function t(){return Object(C.a)(this,t),Object(M.a)(this,Object(L.a)(t).apply(this,arguments))}return Object(F.a)(t,e),Object(A.a)(t,[{key:"render",value:function(){var e=this.props.current;return o.a.createElement(f.a,{params:B},o.a.createElement(f.t,{main:!0,url:e?"/messages/":"/login/"}))}}]),t}(o.a.Component);D.defaultProps={current:null};var R=Object(u.b)(function(e){return{current:Object(h.a)(e.user.accounts,1)[0],settings:e.settings}})(D),V=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4]\d|[01]?\d\d?)){3}$/));function X(e,t){return Y.apply(this,arguments)}function Y(){return(Y=Object(d.a)(m.a.mark(function e(t,n){var a;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.serviceWorker.register(t);case 3:(a=e.sent).onupdatefound=function(){var e=a.installing;e.onstatechange=function(){"installed"===e.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),n&&n.onUpdate&&n.onUpdate(a)):(console.log("Content is cached for offline use."),n&&n.onSuccess&&n.onSuccess(a)))}},e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error during service worker registration:",e.t0);case 10:case"end":return e.stop()}},e,null,[[0,7]])}))).apply(this,arguments)}function H(e,t){return K.apply(this,arguments)}function K(){return(K=Object(d.a)(m.a.mark(function e(t,n){var a,r;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:if(404!==(a=e.sent).status&&-1!==a.headers.get("content-type").indexOf("javascript")){e.next=13;break}return e.next=7,navigator.serviceWorker.ready;case 7:return r=e.sent,e.next=10,r.unregister();case 10:window.location.reload(),e.next=14;break;case 13:X(t,n);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.log("No internet connection found. App is running in offline mode.");case 19:case"end":return e.stop()}},e,null,[[0,16]])}))).apply(this,arguments)}n(64),n(65),n(66),n(67);l.a.use(f.u);var z=Object(c.init)({models:a});s.a.render(o.a.createElement(u.a,{store:z},o.a.createElement(R,null)),document.querySelector("#app")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",Object(d.a)(m.a.mark(function t(){var n;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n="".concat("","/service-worker.js"),!V){t.next=8;break}return H(n,e),t.next=5,navigator.serviceWorker.ready;case 5:console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA"),t.next=9;break;case 8:X(n,e);case 9:case"end":return t.stop()}},t)})))}}()}},[[41,1,2]]]);
//# sourceMappingURL=main.8bf3befb.chunk.js.map