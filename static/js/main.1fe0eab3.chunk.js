(window["webpackJsonpx-fan"]=window["webpackJsonpx-fan"]||[]).push([[0],{36:function(e,t,n){e.exports=n.p+"static/media/github.5a5753ed.svg"},39:function(e,t,n){e.exports=n(64)},63:function(e,t,n){},64:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"user",(function(){return T})),n.d(r,"homeTimeline",(function(){return D})),n.d(r,"settings",(function(){return L}));var a=n(0),o=n.n(a),i=n(23),s=n.n(i),c=n(32),u=n(16),l=n(37),p=n(10),f=n(9),m=n.n(f),g=n(11),d=n(7),h=n(12),b=n(24),v=function(){var e=[];try{e=JSON.parse(localStorage.getItem("accounts"))}catch(t){}return e};function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(n,!0).forEach((function(t){Object(d.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O={consumerKey:"a59ed1e1d9c84ece4d90a6bef1ef30b2",consumerSecret:"aba384864b00fe9f3ed8ece4d21556cd",apiDomain:"cors.fanfou.com",oauthDomain:"cors.fanfou.com",hooks:{baseString:function(e){return e.replace("%2F%2Fcors.fanfou.com%2Foauth","http%3A%2F%2Ffanfou.com%2Foauth").replace("%2F%2Fcors.fanfou.com","http%3A%2F%2Fapi.fanfou.com")}}},j=function(){var e=Object(g.a)(m.a.mark((function e(t,n){var r,a,o,i,s,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new b.a(w({},O,{username:t,password:n})),e.next=3,r.xauth();case 3:if(a=e.sent,o=a.oauthToken,i=a.oauthTokenSecret,!o||!i){e.next=11;break}return s=new b.a(w({},O,{oauthToken:o,oauthTokenSecret:i})),e.next=9,s.get("/account/verify_credentials",{});case 9:return c=e.sent,e.abrupt("return",{token:a,profile:c});case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),k=function(){var e=v();if(0!==e.length){var t=Object(h.a)(e,1)[0].token,n=t.oauthToken,r=t.oauthTokenSecret;return new b.a(w({},O,{oauthToken:n,oauthTokenSecret:r}))}},x=function(e){return k().get("/statuses/home_timeline",w({},e,{format:"html",count:30}))},S=function(e){var t=k();return e.photo?t.upload("/photos/upload",w({},e)):t.post("/statuses/update",w({},e))};function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var P=[];try{P=JSON.parse(localStorage.getItem("accounts"))||[]}catch(re){}var T={state:{accounts:P},reducers:{addAccount:function(e,t){var n=e.accounts.slice();return(n=n.filter((function(e){return e.profile.unique_id!==t.profile.unique_id}))).unshift(t),localStorage.setItem("accounts",JSON.stringify(n)),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(n,!0).forEach((function(t){Object(d.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{accounts:n})},logout:function(){return{accounts:[]}}},effects:{login:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.username,r=t.password,e.next=3,j(n,r);case 3:return(a=e.sent)&&this.addAccount(a),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}};function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(n,!0).forEach((function(t){Object(d.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C=function(e){return!!["",".","\u4e0a\u4f20\u4e86\u65b0\u7167\u7247"].includes(e)||!!Number.isInteger(Number(e))},D={state:{loading:null,sending:null,typing:!1,timeline:[]},reducers:{setLoading:function(e,t){return I({},e,{loading:t})},setSending:function(e,t){return I({},e,{sending:t})},setTimeline:function(e,t){return I({},e,{timeline:t})},appendStatus:function(e,t){var n=e.timeline.concat(t);return I({},e,{timeline:n})},clearTimeline:function(){return{loading:null,sending:null,typing:!1,timeline:[]}}},effects:{fetch:function(){var e=Object(g.a)(m.a.mark((function e(t,n){var r,a,o,i,s,c,u,l,p,f,g,d,b=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 0===(r=n.homeTimeline.timeline).length&&this.setLoading({header:"Loading",avatar:"/x-fan.png"}),e.next=4,x(t);case 4:if(a=e.sent,o=n.homeTimeline.timeline,i=o.slice().reverse(),s=Object(h.a)(i,1),c=s[0],u=(c=void 0===c?{rawId:0}:c).rawId,a=a.filter((function(e){return e.isOrigin()&&e.rawid>u})),l=o.slice(),a.reverse().forEach((function(e){e.photo&&l.push({id:e.id+"-photo",rawId:e.rawid,type:e.is_self?"sent":"received",avatar:e.user.profile_image_url_large,name:e.user.name,image:e.photo.originurl}),C(e.text)||l.push({id:e.id,rawId:e.rawid,name:e.user.name,type:e.is_self?"sent":"received",text:e.plain_text,avatar:e.user.profile_image_url_large})})),l=l.slice(-200),0!==r.length){e.next=18;break}this.setLoading(null),this.setTimeline(l),e.next=28;break;case 18:if(p=l[l.length-1].rawId,f=r[r.length-1].rawId,!(p>f)){e.next=27;break}g=l[l.length-1].text.length,d=1e3+parseInt((g+1)/140*4e3,10),this.setLoading({header:l[l.length-1].name,avatar:l[l.length-1].avatar}),setTimeout((function(){b.setLoading(null),b.setTimeline(l)}),d),e.next=28;break;case 27:case 28:return e.abrupt("return",l);case 29:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),post:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setSending(t),e.next=3,S(I({},t));case 3:if(!(n=e.sent).error){e.next=7;break}return this.setSending(null),e.abrupt("return",n);case 7:return r=[],n.photo&&r.push({id:n.id+"-photo",rawId:n.rawid,type:n.is_self?"sent":"received",avatar:n.user.profile_image_url_large,name:n.user.name,image:n.photo.originurl}),C(n.text)||r.push({id:n.id,rawId:n.rawid,name:n.user.name,type:n.is_self?"sent":"received",text:n.plain_text,avatar:n.user.profile_image_url_large}),this.setSending(null),this.appendStatus(r),e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}};function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var M={};try{M=JSON.parse(localStorage.getItem("settings")||{})}catch(re){}var L={state:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(n,!0).forEach((function(t){Object(d.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},{},{},M),reducers:{updateSettings:function(e){return localStorage.setItem("settings",JSON.stringify(e)),e}},effects:{}},F=n(2),N=n(3),$=n(1),W=n(4),U=n(5),q=function(e){function t(){var e,n;Object(F.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object($.a)(this,(e=Object(W.a)(t)).call.apply(e,[this].concat(a)))).state={username:"",password:""},n.login=Object(g.a)(m.a.mark((function e(){var t,r,a,o,i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.state,r=t.username,a=t.password,o=n.props.login,e.next=4,o({username:r,password:a});case 4:if(i=e.sent,r&&a){e.next=8;break}return n.$f7.dialog.alert("Username and password do not match"),e.abrupt("return");case 8:null===i?n.$f7.dialog.alert("Username and password do not match"):n.$f7router.navigate("/messages/",{clearPreviousHistory:!0});case 9:case"end":return e.stop()}}),e)}))),n}return Object(U.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(p.r,{noToolbar:!0,noNavbar:!0,noSwipeback:!0,loginScreen:!0},o.a.createElement(p.i,null,"X-FAN"),o.a.createElement(p.f,{form:!0},o.a.createElement(p.h,{label:"Username",type:"text",placeholder:"Your username",onInput:function(t){e.setState({username:t.target.value})}}),o.a.createElement(p.h,{label:"Password",type:"password",placeholder:"Your password",onInput:function(t){e.setState({password:t.target.value})}})),o.a.createElement(p.f,null,o.a.createElement(p.g,{onClick:this.login},"Sign In"),o.a.createElement(p.c,null,"Code with \u2764\ufe0f\ufe0f by LitoMore")))}}]),t}(o.a.Component);q.defaultProps={login:function(){}};var J=Object(u.b)((function(e){var t=Object(h.a)(e.user.accounts,1)[0];return{current:void 0===t?{}:t}}),(function(e){return{login:function(t){return e.user.login(t)}}}))(q),B=function(e){function t(){var e,n;Object(F.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object($.a)(this,(e=Object(W.a)(t)).call.apply(e,[this].concat(a)))).state={photo:null,photos:[],messageText:""},n.sendMessage=Object(g.a)(m.a.mark((function e(){var t,r,a,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.state.photo,r=n.messagebar.getValue()){e.next=5;break}return n.$f7.dialog.alert("\u4fe1\u606f\u53d1\u9001\u5931\u8d25\uff0c\u8bf7\u8f93\u5165\u4fe1\u606f\u5185\u5bb9\uff01"),e.abrupt("return");case 5:return a={status:r},t&&(a.photo=t.file),e.prev=7,e.next=10,n.props.post(a);case 10:(o=e.sent).error?n.$f7.dialog.alert(o.error):(document.querySelector("#file").value="",n.messagebar.clear(),n.setState({photo:null})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),t?n.$f7.dialog.alert("\u56fe\u7247\u6587\u4ef6\u8fc7\u5927"):n.$f7.dialog.alert("\u53d1\u9001\u5931\u8d25");case 17:case"end":return e.stop()}}),e,null,[[7,14]])}))),n}return Object(U.a)(t,e),Object(N.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.fetch(),this.timer=setInterval((function(){e.props.fetch()}),1e4);var t=this;t.$f7ready((function(){t.messagebar=t.messagebarComponent.f7Messagebar,t.messages=t.messagesComponent.f7Messages}))}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"isFirstMessage",value:function(e,t){var n=this.props.messages[t-1];return!e.isTitle&&(!n||n.type!==e.type||n.name!==e.name)}},{key:"isLastMessage",value:function(e,t){var n=this.props.messages[t+1];return!e.isTitle&&(!n||n.type!==e.type||n.name!==e.name)}},{key:"isTailMessage",value:function(e,t){var n=this.props.messages[t+1];return!e.isTitle&&(!n||n.type!==e.type||n.name!==e.name)}},{key:"render",value:function(){var e=this,t=this.props,n=t.loading,r=t.sending,a=t.messages,i=this.state,s=i.photo,c=i.photos,u=i.messageText,l=window.innerWidth>400?{maxWidth:300}:null;return o.a.createElement(p.r,{name:"messages"},o.a.createElement("input",{id:"file",type:"file",accept:"image/gif, image/jpeg, image/png, image/jpg",style:{display:"none"},onChange:function(){var t=document.querySelector("#file"),n=Object(h.a)(t.files,1)[0];if(n){var r=new FileReader;r.addEventListener("load",(function(t){var r=t.target.result;e.setState({photo:{file:n,url:r}})})),r.readAsDataURL(n)}}}),c.length>0?o.a.createElement(p.s,{ref:function(t){e.photoBrowser=t},navbar:!1,toolbar:!1,photos:c,value:u,onPhotoBrowserClose:function(){e.setState({photos:[]})}}):null,o.a.createElement(p.k,{ref:function(t){e.messagebarComponent=t},attachmentsVisible:Boolean(s),sheetVisible:this.state.sheetVisible,onInput:function(t){e.setState({messageText:t.target.value})}},o.a.createElement(p.e,{iconAurora:"f7:camera_fill",iconIos:"f7:camera_fill",iconMd:"material:camera_alt",slot:"inner-start",onClick:function(){r||document.querySelector("#file").click()}}),o.a.createElement(p.e,{iconAurora:"f7:ellipsis_circle_fill",iconIos:"f7:ellipsis_circle_fill",iconMd:"material:more_vert",slot:"inner-start",onClick:function(){r||e.$f7router.navigate("/settings/")}}),o.a.createElement(p.e,{iconAurora:"f7:arrow_up_circle_fill",iconIos:"f7:arrow_up_circle_fill",iconMd:"material:send",slot:"inner-end",onClick:function(){r||e.sendMessage()}}),o.a.createElement(p.m,null,s?o.a.createElement(p.l,{image:s.url,onAttachmentDelete:function(){document.querySelector("#file").value="",e.setState({photo:null})}}):null)),o.a.createElement(p.n,{ref:function(t){e.messagesComponent=t},scrollMessagesOnEdge:!0},a.map((function(t,n){return o.a.createElement(p.j,{key:t.id,type:t.type,style:t.image?l:null,image:t.image,name:t.name,avatar:t.avatar,first:e.isFirstMessage(t,n),last:e.isLastMessage(t,n),tail:e.isTailMessage(t,n),onClickBubble:function(){t.image&&e.setState({photos:[t.image]},(function(){e.photoBrowser.open()}))}},t.text&&o.a.createElement("span",{slot:"text"},t.text))})),n&&o.a.createElement(p.j,{typing:!0,first:!0,last:!0,tail:!0,type:"received",header:n.header,avatar:n.avatar})))}}]),t}(o.a.Component);B.defaultProps={loading:null,sending:null,messages:[],fetch:function(){},post:function(){}};var R=Object(u.b)((function(e){return{sending:e.homeTimeline.sending,loading:e.homeTimeline.loading,messages:e.homeTimeline.timeline,settings:e.settings}}),(function(e){return{fetch:function(t){return e.homeTimeline.fetch(t)},post:function(t){return e.homeTimeline.post(t)}}}))(B),V=n(36),X=n.n(V),Y=function(e){function t(){return Object(F.a)(this,t),Object($.a)(this,Object(W.a)(t).apply(this,arguments))}return Object(U.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(p.r,{main:!0},o.a.createElement(p.q,null,o.a.createElement(p.o,{backLink:"back"}),o.a.createElement(p.p,null,"Settings")),o.a.createElement(p.d,null,"ACCOUNT"),o.a.createElement(p.f,null,o.a.createElement(p.g,{title:"Logout",color:"red",onClick:function(){e.$f7router.back("/login/",{force:!0}),localStorage.removeItem("accounts"),e.props.logout(),e.props.clearTimeline()}})),o.a.createElement(p.b,{style:{textAlign:"center"}},o.a.createElement(p.e,{external:!0,href:"https://github.com/LitoMore/x-fan",target:"_blank"},o.a.createElement("img",{alt:"github-badge",src:X.a}))))}}]),t}(o.a.Component);Y.defaultProps={logout:function(){},clearTimeline:function(){}};var H={name:"X-FAN",id:"com.litomore.xfanfou",routes:[{name:"messages",path:"/messages/",component:R},{name:"login",path:"/login/",component:J},{name:"settings",path:"/settings/",component:Object(u.b)((function(e){return{settings:e.settings}}),(function(e){return{logout:function(){return e.user.logout()},clearTimeline:function(){return e.homeTimeline.clearTimeline()}}}))(Y)}],theme:"MacIntel"===window.navigator.platform?"ios":"auto"},K=function(e){function t(){return Object(F.a)(this,t),Object($.a)(this,Object(W.a)(t).apply(this,arguments))}return Object(U.a)(t,e),Object(N.a)(t,[{key:"render",value:function(){var e=this.props.current;return o.a.createElement(p.a,{params:H},o.a.createElement(p.t,{main:!0,url:e?"/messages/":"/login/"}))}}]),t}(o.a.Component);K.defaultProps={current:null};var z=Object(u.b)((function(e){return{current:Object(h.a)(e.user.accounts,1)[0],settings:e.settings}}))(K),G=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4]\d|[01]?\d\d?)){3}$/));function Q(e,t){return Z.apply(this,arguments)}function Z(){return(Z=Object(g.a)(m.a.mark((function e(t,n){var r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.serviceWorker.register(t);case 3:(r=e.sent).onupdatefound=function(){var e=r.installing;e.onstatechange=function(){"installed"===e.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),n&&n.onUpdate&&n.onUpdate(r)):(console.log("Content is cached for offline use."),n&&n.onSuccess&&n.onSuccess(r)))}},e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error during service worker registration:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function ee(e,t){return te.apply(this,arguments)}function te(){return(te=Object(g.a)(m.a.mark((function e(t,n){var r,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:if(404!==(r=e.sent).status&&r.headers.get("content-type").includes("javascript")){e.next=13;break}return e.next=7,navigator.serviceWorker.ready;case 7:return a=e.sent,e.next=10,a.unregister();case 10:window.location.reload(),e.next=14;break;case 13:Q(t,n);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.log("No internet connection found. App is running in offline mode.");case 19:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}n(60),n(61),n(62),n(63);l.a.use(p.u);var ne=Object(c.init)({models:r});s.a.render(o.a.createElement(u.a,{store:ne},o.a.createElement(z,null)),document.querySelector("#app")),function(e){if("serviceWorker"in navigator){if(new URL("/x-fan",window.location).origin!==window.location.origin)return;window.addEventListener("load",Object(g.a)(m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n="".concat("/x-fan","/service-worker.js"),!G){t.next=8;break}return ee(n,e),t.next=5,navigator.serviceWorker.ready;case 5:console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA"),t.next=9;break;case 8:Q(n,e);case 9:case"end":return t.stop()}}),t)}))))}}()}},[[39,1,2]]]);
//# sourceMappingURL=main.1fe0eab3.chunk.js.map