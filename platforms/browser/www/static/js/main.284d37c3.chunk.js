(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{37:function(e,t,n){e.exports=n.p+"static/media/github.5a5753ed.svg"},40:function(e,t,n){e.exports=n(65)},63:function(e,t,n){},65:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"user",function(){return x}),n.d(a,"homeTimeline",function(){return S}),n.d(a,"settings",function(){return I});var r=n(0),o=n.n(r),i=n(31),s=n.n(i),c=n(32),u=n(17),l=n(38),f=n(7),m=n(9),g=n.n(m),p=n(12),h=n(13),d=n(14),v=n(25),b=function(){var e=[];try{e=JSON.parse(localStorage.getItem("accounts"))}catch(t){}return e},w={consumerKey:"a59ed1e1d9c84ece4d90a6bef1ef30b2",consumerSecret:"aba384864b00fe9f3ed8ece4d21556cd",apiDomain:"cors.fanfou.com",oauthDomain:"cors.fanfou.com",hooks:{baseString:function(e){return e.replace("%2F%2Fcors.fanfou.com%2Foauth","http%3A%2F%2Ffanfou.com%2Foauth").replace("%2F%2Fcors.fanfou.com","http%3A%2F%2Fapi.fanfou.com")}}},k=function(){var e=Object(p.a)(g.a.mark(function e(t,n){var a,r,o,i,s,c;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new v.a(Object(h.a)({},w,{username:t,password:n})),e.next=3,a.xauth();case 3:if(r=e.sent,o=r.oauthToken,i=r.oauthTokenSecret,!o||!i){e.next=11;break}return s=new v.a(Object(h.a)({},w,{oauthToken:o,oauthTokenSecret:i})),e.next=9,s.get("/account/verify_credentials",{});case 9:return c=e.sent,e.abrupt("return",{token:r,profile:c});case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=b();if(0!==e.length){var t=Object(d.a)(e,1)[0].token,n=t.oauthToken,a=t.oauthTokenSecret;return new v.a(Object(h.a)({},w,{oauthToken:n,oauthTokenSecret:a}))}},O=function(e){return y().get("/statuses/home_timeline",Object(h.a)({},e,{format:"html",count:30}))},j=function(e){var t=y();return e.photo?t.upload("/photos/upload",Object(h.a)({},e)):t.post("/statuses/update",Object(h.a)({},e))},E=[];try{E=JSON.parse(localStorage.getItem("accounts"))||[]}catch(X){}var x={state:{accounts:E},reducers:{addAccount:function(e,t){var n=e.accounts.slice();return(n=n.filter(function(e){return e.profile.unique_id!==t.profile.unique_id})).unshift(t),localStorage.setItem("accounts",JSON.stringify(n)),Object(h.a)({},e,{accounts:n})},logout:function(){return{accounts:[]}}},effects:{login:function(){var e=Object(p.a)(g.a.mark(function e(t){var n,a,r;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.username,a=t.password,e.next=3,k(n,a);case 3:return(r=e.sent)&&this.addAccount(r),e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},S={state:{loading:null,sending:null,typing:!1,timeline:[]},reducers:{setLoading:function(e,t){return Object(h.a)({},e,{loading:t})},setSending:function(e,t){return Object(h.a)({},e,{sending:t})},setTimeline:function(e,t){return Object(h.a)({},e,{timeline:t})},appendStatus:function(e,t){var n=e.timeline.concat(t);return Object(h.a)({},e,{timeline:n})},clearTimeline:function(){return{loading:null,sending:null,typing:!1,timeline:[]}}},effects:{fetch:function(){var e=Object(p.a)(g.a.mark(function e(t,n){var a,r,o,i,s,c,u,l,f,m,p,h,v=this;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return 0===(a=n.homeTimeline.timeline).length&&this.setLoading({header:"Loading",avatar:"/x-fan.png"}),e.next=4,O(t);case 4:if(r=e.sent,o=n.homeTimeline.timeline,i=o.slice().reverse(),s=Object(d.a)(i,1),c=s[0],u=(c=void 0===c?{rawId:0}:c).rawId,r=r.filter(function(e){return e.isOrigin()&&e.rawid>u}),l=o.slice(),r.reverse().forEach(function(e){e.photo&&l.push({id:e.id+"-photo",rawId:e.rawid,type:e.is_self?"sent":"received",avatar:e.user.profile_image_origin_large,name:e.user.name,image:e.photo.originurl}),""!==e.text&&"\u4e0a\u4f20\u4e86\u65b0\u7167\u7247"!==e.text&&l.push({id:e.id,rawId:e.rawid,name:e.user.name,type:e.is_self?"sent":"received",text:e.plain_text,avatar:e.user.profile_image_origin_large})}),l=l.slice(-200),0!==a.length){e.next=18;break}this.setLoading(null),this.setTimeline(l),e.next=28;break;case 18:if(f=l[l.length-1].rawId,m=a[a.length-1].rawId,!(f>m)){e.next=27;break}p=l[l.length-1].text.length,h=1e3+parseInt((p+1)/140*4e3,10),this.setLoading({header:l[l.length-1].name,avatar:l[l.length-1].avatar}),setTimeout(function(){v.setLoading(null),v.setTimeline(l)},h),e.next=28;break;case 27:case 28:return e.abrupt("return",l);case 29:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),post:function(){var e=Object(p.a)(g.a.mark(function e(t){var n,a;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setSending(t),e.next=3,j(Object(h.a)({},t));case 3:if(!(n=e.sent).error){e.next=7;break}return this.setSending(null),e.abrupt("return",n);case 7:return a=[],n.photo&&a.push({id:n.id+"-photo",rawId:n.rawid,type:n.is_self?"sent":"received",avatar:n.user.profile_image_origin_large,name:n.user.name,image:n.photo.originurl}),""!==n.text&&"\u4e0a\u4f20\u4e86\u65b0\u7167\u7247"!==n.text&&a.push({id:n.id,rawId:n.rawid,name:n.user.name,type:n.is_self?"sent":"received",text:n.plain_text,avatar:n.user.profile_image_origin_large}),this.setSending(null),this.appendStatus(a),e.abrupt("return",a);case 13:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},T={};try{T=JSON.parse(localStorage.getItem("settings")||{})}catch(X){}var I={state:Object(h.a)({},{nightMode:!1},T),reducers:{updateSettings:function(e){return localStorage.setItem("settings",JSON.stringify(e)),e},setNightMode:function(e,t){return Object(h.a)({},e,{nightMode:t})}},effects:{switchNightMode:function(e){return this.setNightMode(e),this.updateSettings(),e}}},M=n(2),_=n(3),C=n(1),N=n(4),L=n(5),A=function(e){function t(e){var n;return Object(M.a)(this,t),(n=Object(C.a)(this,Object(N.a)(t).call(this,e))).login=Object(p.a)(g.a.mark(function e(){var t,a,r,o;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.state,a=t.username,r=t.password,o=n.props.login,e.next=4,o({username:a,password:r});case 4:null===e.sent?n.$f7.dialog.alert("Username and password do not match","X-FAN"):n.$f7router.navigate("/messages/",{clearPreviousHistory:!0});case 6:case"end":return e.stop()}},e,this)})),n.state={username:"",password:""},n}return Object(L.a)(t,e),Object(_.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement(f.t,{noToolbar:!0,noNavbar:!0,noSwipeback:!0,loginScreen:!0},o.a.createElement(f.k,null,"X-FAN"),o.a.createElement(f.h,{form:!0},o.a.createElement(f.j,null,o.a.createElement(f.f,null,"Username"),o.a.createElement(f.e,{type:"text",placeholder:"Your username",onInput:function(t){e.setState({username:t.target.value})}})),o.a.createElement(f.j,null,o.a.createElement(f.f,null,"Password"),o.a.createElement(f.e,{type:"password",placeholder:"Your password",onInput:function(t){e.setState({password:t.target.value})}}))),o.a.createElement(f.h,null,o.a.createElement(f.i,{onClick:this.login},"Sign In"),o.a.createElement(f.c,null,"Code with \u2764\ufe0f\ufe0f by LitoMore")))}}]),t}(o.a.Component),F=Object(u.b)(function(e){var t=Object(d.a)(e.user.accounts,1)[0];return{current:void 0===t?{}:t}},function(e){return{login:function(t){return e.user.login(t)}}})(A),B=function(e){function t(e){var n;return Object(M.a)(this,t),(n=Object(C.a)(this,Object(N.a)(t).call(this,e))).sendMessage=Object(p.a)(g.a.mark(function e(){var t,a,r,o;return g.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.state.photo,a=n.messagebar.getValue(),r={status:a},t&&(r.photo=t.file),e.prev=4,e.next=7,n.props.post(r);case 7:(o=e.sent).error?n.$f7.dialog.alert(o.error,"Error"):(document.getElementById("file").value="",n.messagebar.clear(),n.setState({photo:null})),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),t?n.$f7.dialog.alert("\u56fe\u7247\u6587\u4ef6\u8fc7\u5927"):n.$f7.dialog.alert("\u53d1\u9001\u5931\u8d25");case 14:case"end":return e.stop()}},e,this,[[4,11]])})),n.state={photo:null,photos:[]},n}return Object(L.a)(t,e),Object(_.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.fetch(),this.timer=setInterval(function(){e.props.fetch()},1e4);var t=this;t.$f7ready(function(){t.messagebar=t.messagebarComponent.f7Messagebar,t.messages=t.messagesComponent.f7Messages})}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"isFirstMessage",value:function(e,t){var n=this.props.messages[t-1];return!e.isTitle&&(!n||n.type!==e.type||n.name!==e.name)}},{key:"isLastMessage",value:function(e,t){var n=this.props.messages[t+1];return!e.isTitle&&(!n||n.type!==e.type||n.name!==e.name)}},{key:"isTailMessage",value:function(e,t){var n=this.props.messages[t+1];return!e.isTitle&&(!n||n.type!==e.type||n.name!==e.name)}},{key:"render",value:function(){var e=this,t=this.props,n=t.loading,a=t.sending,r=t.messages,i=this.state,s=i.photo,c=i.photos,u=window.innerWidth>400?{maxWidth:300}:null;return o.a.createElement(f.t,{name:"messages"},o.a.createElement("input",{id:"file",type:"file",accept:"image/gif, image/jpeg, image/png, image/jpg",style:{display:"none"},onChange:function(){var t=document.getElementById("file"),n=Object(d.a)(t.files,1)[0];if(n){var a=new FileReader;a.addEventListener("load",function(t){var a=t.target.result;e.setState({photo:{file:n,url:a}})}),a.readAsDataURL(n)}}}),c.length>0?o.a.createElement(f.u,{ref:function(t){e.photoBrowser=t},theme:this.props.settings.nightMode?"dark":"light",navbar:!1,toolbar:!1,photos:c,onPhotoBrowserClose:function(){e.setState({photos:[]})}}):null,o.a.createElement(f.m,{ref:function(t){e.messagebarComponent=t},attachmentsVisible:Boolean(s),placeholder:this.placeholder,sheetVisible:this.state.sheetVisible},o.a.createElement(f.g,{iconIos:"f7:camera_fill",iconMd:"material:camera_alt",slot:"inner-start",onClick:function(){a||document.getElementById("file").click()}}),o.a.createElement(f.g,{iconIos:"f7:more_round_fill",iconMd:"material:more_vert",slot:"inner-start",onClick:function(){a||e.$f7router.navigate("/settings/")}}),o.a.createElement(f.g,{iconIos:"f7:arrow_up_fill",iconMd:"material:send",slot:"inner-end",onClick:function(){a||e.sendMessage()}}),o.a.createElement(f.o,null,s?o.a.createElement(f.n,{image:s.url,onAttachmentDelete:function(){document.getElementById("file").value="",e.setState({photo:null})}}):null)),o.a.createElement(f.p,{ref:function(t){e.messagesComponent=t},scrollMessagesOnEdge:!0},r.map(function(t,n){return o.a.createElement(f.l,{key:t.id,type:t.type,style:t.image?u:null,image:t.image,name:t.name,avatar:t.avatar,first:e.isFirstMessage(t,n),last:e.isLastMessage(t,n),tail:e.isTailMessage(t,n),onClickBubble:function(){t.image&&e.setState({photos:[t.image]},function(){e.photoBrowser.open()})}},t.text&&o.a.createElement("span",{slot:"text"},t.text))}),n&&o.a.createElement(f.l,{typing:!0,first:!0,last:!0,tail:!0,type:"received",header:n.header,avatar:n.avatar})))}}]),t}(o.a.Component);B.defaultProps={loading:null,sending:null,settings:{},messages:[],fetch:function(){},post:function(){}};var W=Object(u.b)(function(e){return{sending:e.homeTimeline.sending,loading:e.homeTimeline.loading,messages:e.homeTimeline.timeline,settings:e.settings}},function(e){return{fetch:function(t){return e.homeTimeline.fetch(t)},post:function(t){return e.homeTimeline.post(t)}}})(B),P=n(37),$=n.n(P),U=function(e){function t(){return Object(M.a)(this,t),Object(C.a)(this,Object(N.a)(t).apply(this,arguments))}return Object(L.a)(t,e),Object(_.a)(t,[{key:"render",value:function(){var e=this,t=this.props.settings;return o.a.createElement(f.t,{main:!0},o.a.createElement(f.s,null,o.a.createElement(f.q,{backLink:"back"}),o.a.createElement(f.r,null,"Settings")),o.a.createElement(f.d,null,"DISPLAY"),o.a.createElement(f.h,null,o.a.createElement(f.j,{title:"Night mode"},o.a.createElement(f.v,{slot:"after",checked:t.nightMode,onToggleChange:function(t){e.props.switchNightMode(t)}}))),o.a.createElement(f.d,null,"ACCOUNT"),o.a.createElement(f.h,null,o.a.createElement(f.i,{title:"Logout",color:"red",onClick:function(){e.$f7router.back("/login/",{force:!0}),localStorage.removeItem("accounts"),e.props.logout(),e.props.clearTimeline()}})),o.a.createElement(f.b,{style:{textAlign:"center"}},o.a.createElement(f.g,{external:!0,href:"https://github.com/LitoMore/x-fan",target:"_blank"},o.a.createElement("img",{alt:"github-badge",src:$.a}))))}}]),t}(o.a.Component);U.defaultProps={logout:function(){},clearTimeline:function(){},switchNightMode:function(){},settings:{}};var D={name:"Fanfou",id:"com.litomore.xfanfou",routes:[{name:"messages",path:"/messages/",component:W},{name:"login",path:"/login/",component:F},{name:"settings",path:"/settings/",component:Object(u.b)(function(e){return{settings:e.settings}},function(e){return{logout:function(){return e.user.logout()},clearTimeline:function(){return e.homeTimeline.clearTimeline()},switchNightMode:function(t){return e.settings.switchNightMode(t)}}})(U)}],theme:"MacIntel"===window.navigator.platform?"ios":"auto"},J=function(e){function t(){return Object(M.a)(this,t),Object(C.a)(this,Object(N.a)(t).apply(this,arguments))}return Object(L.a)(t,e),Object(_.a)(t,[{key:"render",value:function(){var e=this.props,t=e.current,n=e.settings;return o.a.createElement(f.a,{params:D,themeDark:n.nightMode},o.a.createElement(f.w,{main:!0,url:t?"/messages/":"/login/"}))}}]),t}(o.a.Component);J.defaultProps={current:null,settings:{}};var R=Object(u.b)(function(e){return{current:Object(d.a)(e.user.accounts,1)[0],settings:e.settings}})(J),V=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4]\d|[01]?\d\d?)){3}$/));function q(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}n(57),n(59),n(61),n(63);l.a.use(f.x);var Y=Object(c.init)({models:a});s.a.render(o.a.createElement(u.a,{store:Y},o.a.createElement(R,null)),document.getElementById("app")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("","/service-worker.js");V?(function(e,t){fetch(e).then(function(n){404===n.status||-1===n.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):q(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):q(t,e)})}}()}},[[40,2,1]]]);
//# sourceMappingURL=main.284d37c3.chunk.js.map